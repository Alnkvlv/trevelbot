import os
import asyncio
import os
import asyncio
import threading
from http.server import HTTPServer, BaseHTTPRequestHandler  # <-- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
from aiogram import Bot, Dispatcher, types
from aiogram.types import (
    Message,
    ReplyKeyboardMarkup,
    KeyboardButton,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    FSInputFile
)
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.fsm.state import StatesGroup, State


# ---------------------------
# Dummy HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è Render Free Plan
# ---------------------------
class DummyHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.end_headers()
        self.wfile.write(b"OK")

def run_dummy_server():
    server = HTTPServer(("0.0.0.0", 10000), DummyHandler)
    server.serve_forever()

# –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
threading.Thread(target=run_dummy_server, daemon=True).start()

# ---------------------------
# –¢–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
# ---------------------------
TOKEN = os.getenv("TOKEN")

if not TOKEN:
    raise ValueError("‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è TOKEN –Ω–µ –∑–∞–¥–∞–Ω–∞")

bot = Bot(token=TOKEN)
dp = Dispatcher(storage=MemoryStorage())

# ---------------------------
# –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
# ---------------------------
BASE_DIR = os.path.dirname(os.path.abspath(__file__))

# ---------------------------
# –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
# ---------------------------
local_images = {
    "–†–æ—Å—Å–∏—è": {
        "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å": os.path.join(BASE_DIR, "images", "RedSquare.jpg"),
        "–ë–æ—Ä—â": os.path.join(BASE_DIR, "images", "Borsh.jpg"),
        "–ü–µ–ª—å–º–µ–Ω–∏": os.path.join(BASE_DIR, "images", "Pelmeni.jpg"),
        "–ë–ª–∏–Ω—ã": os.path.join(BASE_DIR, "images", "Blini.jpg")
    },
    "–§—Ä–∞–Ω—Ü–∏—è": {
        "–≠–π—Ñ–µ–ª–µ–≤–∞ –±–∞—à–Ω—è": os.path.join(BASE_DIR, "images", "EiffelTower.jpg"),
        "–ö—Ä—É–∞—Å—Å–∞–Ω—ã": os.path.join(BASE_DIR, "images", "Croissant.jpg"),
        "–ë–∞–≥–µ—Ç—ã": os.path.join(BASE_DIR, "images", "Baguette.jpg"),
        "–°—ã—Ä": os.path.join(BASE_DIR, "images", "Cheese.jpg")
    },
    "–Ø–ø–æ–Ω–∏—è": {
        "–¢–æ–∫–∏–π—Å–∫–∞—è –±–∞—à–Ω—è": os.path.join(BASE_DIR, "images", "TokyoTower.jpg"),
        "–°—É—à–∏": os.path.join(BASE_DIR, "images", "Sushi.jpg"),
        "–†–∞–º–µ–Ω": os.path.join(BASE_DIR, "images", "Ramen.jpg"),
        "–¢—ç–º–ø—É—Ä–∞": os.path.join(BASE_DIR, "images", "Tempura.jpg")
    },
    "–°–µ—Ä–±–∏—è": {
        "ƒÜevapƒçiƒái (—á–µ–≤a–ø—á–∏—á–∏)": os.path.join(BASE_DIR, "images", "ƒÜevapƒçiƒái.jpg"),
        "Pljeskavica (–ø–ª–µ—Å–∫–∞–≤–∏—Ü–∞)": os.path.join(BASE_DIR, "images", "Pljeskavica.jpg"),
        "Burek": os.path.join(BASE_DIR, "images", "Burek.jpg"
    }
}

# ---------------------------
# –î–∞–Ω–Ω—ã–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º
# ---------------------------
countries_info = {
    "–†–æ—Å—Å–∏—è": {
        "–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏": "–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ –≤–∏–∑–µ –∏ –ø—Ä–∞–≤–∏–ª–∞—Ö —Ç–∞–º–æ–∂–Ω–∏.",
        "–¢—Ä–µ–±—É–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã": "–ü–∞—Å–ø–æ—Ä—Ç, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞, –±–∏–ª–µ—Ç—ã.",
        "–°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –≤–∑—è—Ç—å": "–¢—ë–ø–ª–∞—è –æ–¥–µ–∂–¥–∞, —É–¥–æ–±–Ω–∞—è –æ–±—É–≤—å, –¥–æ–∫—É–º–µ–Ω—Ç—ã.",
        "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è": ["–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å", "–≠—Ä–º–∏—Ç–∞–∂", "–ë–∞–π–∫–∞–ª"],
        "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è": ["–ë–æ—Ä—â", "–ü–µ–ª—å–º–µ–Ω–∏", "–ë–ª–∏–Ω—ã"]
    },
    "–§—Ä–∞–Ω—Ü–∏—è": {
        "–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏": "–°–æ–±–ª—é–¥–∞–π—Ç–µ –º–µ—Å—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Ä–æ–∂–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è.",
        "–¢—Ä–µ–±—É–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã": "–ü–∞—Å–ø–æ—Ä—Ç, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞, –±–∏–ª–µ—Ç—ã.",
        "–°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –≤–∑—è—Ç—å": "–õ—ë–≥–∫–∞—è –æ–¥–µ–∂–¥–∞, –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–æ–∑–µ—Ç–æ–∫, —Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç.",
        "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è": ["–≠–π—Ñ–µ–ª–µ–≤–∞ –±–∞—à–Ω—è", "–õ—É–≤—Ä", "–í–µ—Ä—Å–∞–ª—å"],
        "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è": ["–ö—Ä—É–∞—Å—Å–∞–Ω—ã", "–ë–∞–≥–µ—Ç—ã", "–°—ã—Ä"]
    },
    "–Ø–ø–æ–Ω–∏—è": {
        "–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏": "–£–≤–∞–∂–∞–π—Ç–µ –º–µ—Å—Ç–Ω—ã–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞.",
        "–¢—Ä–µ–±—É–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã": "–ü–∞—Å–ø–æ—Ä—Ç, –≤–∏–∑–∞, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.",
        "–°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –≤–∑—è—Ç—å": "–£–¥–æ–±–Ω–∞—è –æ–±—É–≤—å, –∑–æ–Ω—Ç–∏–∫, –∫–∞—Ä—Ç–∞ –≥–æ—Ä–æ–¥–∞.",
        "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è": ["–¢–æ–∫–∏–π—Å–∫–∞—è –±–∞—à–Ω—è", "–ö–∏–æ—Ç–æ", "–§—É–¥–∑–∏"],
        "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è": ["–°—É—à–∏", "–†–∞–º–µ–Ω", "–¢—ç–º–ø—É—Ä–∞"]
    },
    "–°–µ—Ä–±–∏—è": {
        "–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏": (
        "üó£–Ø–∑—ã–∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π ‚Äî —Å–µ—Ä–±—Å–∫–∏–π (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –∏ –ª–∞—Ç–∏–Ω–∏—Ü–∞). –í —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –ø–æ‚Äë–∞–Ω–≥–ª–∏–π—Å–∫–∏. –ù–µ–±–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä —Ñ—Ä–∞–∑ –Ω–∞ —Å–µ—Ä–±—Å–∫–æ–º –ø–æ–º–æ–∂–µ—Ç.\n"
        "üí∞–í–∞–ª—é—Ç–∞ —Å–µ—Ä–±—Å–∫–∏–π –¥–∏–Ω–∞—Ä (RSD). –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤ –≥–æ—Ä–æ–¥–∞—Ö, –Ω–æ –≤ –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–æ—Å–µ–ª–µ–Ω–∏—è—Ö –∏ –Ω–∞ —Ä—ã–Ω–∫–∞—Ö —á–∞—â–µ –±–µ—Ä—É—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–Ω—ã–µ.\n"
        "‚õ™–†–µ–ª–∏–≥–∏—è –ø—Ä–∞–≤–æ—Å–ª–∞–≤–∏–µ —à–∏—Ä–æ–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ ‚Äî —É–≤–∞–∂–∞–π—Ç–µ –º–æ–Ω–∞—Å—Ç—ã—Ä–∏ –∏ —Ü–µ—Ä–∫–≤–∏: –∑–∞–∫—Ä—ã—Ç–∞—è –æ–¥–µ–∂–¥–∞, –æ–±—É–≤—å —Ç–∏—Ö–∞—è, –ø—Ä–∏ –≤—Ö–æ–¥–µ –¥–µ—Ä–∂–∞—Ç—å —Ä—É–∫–∏ –∏ –Ω–µ —à—É–º–µ—Ç—å.\n"
        "üîí–í —Ü–µ–ª–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –≤ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∑–æ–Ω–∞—Ö –≤–æ–∑–º–æ–∂–Ω—ã –∫–∞—Ä–º–∞–Ω–Ω—ã–µ –∫—Ä–∞–∂–∏ ‚Äî —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –≤–µ—â–∞–º–∏.\n"
        "üì∏–°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ª—é–¥–µ–π; –Ω–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã —Å –æ—Ö—Ä–∞–Ω–æ–π/–≤–æ–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏.\n"
        "üö≠–ö—É—Ä–µ–Ω–∏–µ –≤ –∑–∞–∫—Ä—ã—Ç—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö —á–∞—Å—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.\n"
        "üç∑–ê–ª–∫–æ–≥–æ–ª—å: –º–æ–ª–æ–¥–µ–∂–Ω—ã–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç—ã (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ –ë–µ–ª–≥—Ä–∞–¥–µ), –Ω–æ –ø—É–±–ª–∏—á–Ω–æ–µ –æ–ø—å—è–Ω–µ–Ω–∏–µ/–ø—Ä–æ–≤–æ–∫–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è.\n"
        "‚ùå–ß—Ç–æ –Ω–µ–ª—å–∑—è: –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏ ‚Äî —Å—Ç—Ä–æ–≥–∏–µ –Ω–∞–∫–∞–∑–∞–Ω–∏—è; –ø—Ä–æ–≤–æ–∑ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (–∞–ª–∫–æ–≥–æ–ª—å, —Ç–∞–±–∞–∫ —Å–≤—ã—à–µ –Ω–æ—Ä–º, –∫—Ä—É–ø–Ω—ã–µ —Å—É–º–º—ã –Ω–∞–ª–∏—á–Ω—ã—Ö ‚Äî –¥–µ–∫–ª–∞—Ä–∏—Ä—É–π—Ç–µ).\n"
        "üöó–î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∞–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ. –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–æ–ª–∏—Ü–∏–µ–π –≤–µ–∂–ª–∏–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞—Ç—å; –ø—Ä–∞–≤–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è EU, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–º–µ—Ç—å IDP.\n"
        "üåü–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã: —Å—Ç–æ–ª–µ—Ç–Ω–∏–µ –º–æ–Ω–∞—Å—Ç—ã—Ä–∏, —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –∫—É—Ö–Ω—è —Å —Å–∏–ª—å–Ω—ã–º –≤–ª–∏—è–Ω–∏–µ–º –ë–∞–ª–∫–∞–Ω/–û—Å–º–∞–Ω—Å–∫–æ–π/–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ï–≤—Ä–æ–ø—ã. –ë–µ–ª–≥—Ä–∞–¥ ‚Äî –æ–∂–∏–≤–ª—ë–Ω–Ω—ã–π –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∏ –Ω–æ—á–Ω–æ–π —Ü–µ–Ω—Ç—Ä."
    ),
        "–¢—Ä–µ–±—É–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã": (
        "üõÇ–ü–∞—Å–ø–æ—Ä—Ç: –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –Ω–∞ –ø–µ—Ä–∏–æ–¥ –ø–æ–µ–∑–¥–∫–∏; —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç –∏–º–µ—Ç—å –∑–∞–ø–∞—Å –º–∏–Ω–∏–º—É–º 3 –º–µ—Å—è—Ü–∞ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω—ã).\n"
        "üõÉ–í–∏–∑–∞: –¥–ª—è –≥—Ä–∞–∂–¥–∞–Ω –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω (–ï–°, –°–®–ê, –ö–∞–Ω–∞–¥–∞, UK –∏ –¥—Ä.) —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –±–µ–∑–≤–∏–∑–æ–≤–æ–µ –ø—Ä–µ–±—ã–≤–∞–Ω–∏–µ (–æ–±—ã—á–Ω–æ –¥–æ 30‚Äì90 –¥–Ω–µ–π). –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∏–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤—É –Ω–∞ —Å–∞–π—Ç–µ –ø–æ—Å–æ–ª—å—Å—Ç–≤–∞/–∫–æ–Ω—Å—É–ª—å—Å—Ç–≤–∞.\n"
        "‚úàÔ∏è–ë–∏–ª–µ—Ç—ã —Ç—É–¥–∞/–æ–±—Ä–∞—Ç–Ω–æ –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞–ª—å–Ω–µ–π—à–µ–π –ø–æ–µ–∑–¥–∫–∏ (–∏–Ω–æ–≥–¥–∞ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ).\n"
        "üè®–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∂–∏–ª—å—è (–∏–Ω–æ–≥–¥–∞ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∏ –≤—ä–µ–∑–¥–µ).\n"
        "üè•–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–∫—Ä—ã—Ç–∏–µ —Ä–µ–ø–∞—Ç—Ä–∏–∞—Ü–∏–∏ –∏ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏).\n"
        "üöò–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∞: –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –æ–±—ã—á–Ω–æ –¥–µ–π—Å—Ç–≤—É—é—Ç; –¥–ª—è —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –≤–æ–∑—å–º–∏—Ç–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–µ –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ (IDP).\n"
        "üíâ–ü—Ä–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–µ/–æ—Å–æ–±—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö: –ø—Ä–∏–≤–∏–≤–æ—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–≤–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ —ç–ø–∏–¥–µ–º–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ ‚Äî —É—Ç–æ—á–Ω—è–π—Ç–µ –ø–µ—Ä–µ–¥ –ø–æ–µ–∑–¥–∫–æ–π).\n"
        "üóÇ–ö–æ–ø–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–∫–∞–Ω—ã –ø–∞—Å–ø–æ—Ä—Ç–∞/–≤–∏–∑/—Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –æ–±–ª–∞–∫–µ –∏ –±—É–º–∞–∂–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞."
    ),
    "–°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –≤–∑—è—Ç—å":(
        "üß•–¢–µ–ø–ª–∞—è –∏ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è –æ–¥–µ–∂–¥–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –ø–æ–µ–∑–¥–∫–∞ –≤–Ω–µ –ª–µ—Ç–∞) ‚Äî –≤ –≥–æ—Ä–∞—Ö –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–≥–æ–¥–∞.\n"
        "üëü–£–¥–æ–±–Ω–∞—è –æ–±—É–≤—å –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫ –∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–∞–º–µ–Ω–∏—Å—Ç—ã—Ö —Ç—Ä–æ–ø (–µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∫–∏).\n" 
        "üåß–õ—ë–≥–∫–∞—è –∫—É—Ä—Ç–∫–∞/–≤–µ—Ç—Ä–æ–≤–∫–∞ –∏ –¥–æ–∂–¥–µ–≤–∏–∫.\n"
        "üîå–ó–∞—Ä—è–¥–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, power bank –∏ –ø–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫ –¥–ª—è —Ä–æ–∑–µ—Ç–æ–∫ (—Ç–∏–ø F, 230V; –∞–¥–∞–ø—Ç–µ—Ä—ã —Ç–∏–ø–∞ C/F —Ä–∞–±–æ—Ç–∞—é—Ç).\n"
        "üíä–ú–∞–ª–µ–Ω—å–∫–∞—è –∞–ø—Ç–µ—á–∫–∞: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞, –æ–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ, –ø–ª–∞—Å—Ç—ã—Ä–∏, —Å—Ä–µ–¥—Å—Ç–≤–æ –æ—Ç —É–∫–∞—á–∏–≤–∞–Ω–∏—è, –∞–Ω—Ç–∏–≥–∏—Å—Ç–∞–º–∏–Ω–Ω—ã–µ.\n"
        "üíµ–ù–∞–ª–∏—á–Ω—ã–µ –≤ –¥–∏–Ω–∞—Ä–∞—Ö –∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã (—Å–æ–æ–±—â–∏—Ç–µ –±–∞–Ω–∫—É –æ –ø–æ–µ–∑–¥–∫–µ).\n"
        "üï∂–°–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ –æ—á–∫–∏ –∏ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–π –∫—Ä–µ–º (–ª–µ—Ç–æ–º).\n"
        "üö∞–†—é–∫–∑–∞–∫ –Ω–∞ –¥–µ–Ω—å, –µ–º–∫–æ—Å—Ç—å –¥–ª—è –≤–æ–¥—ã.\n"
        "üîí–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∑–∞–º–æ–∫ –¥–ª—è –±–∞–≥–∞–∂–∞ –∏ –Ω–µ–±–æ–ª—å—à–∞—è —Å—É–º–∫–∞ –Ω–∞ —Ä–µ–º–Ω–µ –¥–ª—è —Ü–µ–Ω–Ω—ã—Ö –≤–µ—â–µ–π.\n"
        "‚õ∑–ü—Ä–∏ –ø–ª–∞–Ω–∞—Ö –Ω–∞ –≥–æ—Ä—ã/–∑–∏–º—É ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–¥–µ–∂–¥–∞ (–≥–æ—Ä–Ω—ã–µ –±–æ—Ç–∏–Ω–∫–∏, —Ç–µ—Ä–º–æ–±–µ–ª—å–µ).\n"
        "üì∑–§–æ—Ç–æ–∫–∞–º–µ—Ä–∞/—Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –∫–∞—Ä—Ç–∞–º–∏ –æ—Ñ–ª–∞–π–Ω (–∏–ª–∏ –∫–∞—Ä—Ç–∞)."
    ),
    "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è": ["–ö–∞–ª–µ–º–µ–≥–¥–∞–Ω—Å–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å ‚Äî –≤–∏–¥ –Ω–∞ —Å–ª–∏—è–Ω–∏–µ –°–∞–≤—ã –∏ –î—É–Ω–∞—è, –º—É–∑–µ–∏ –∏ –ø–∞—Ä–∫.", "–°–∫–∞–¥–∞—Ä–ª–∏—è ‚Äî —Å—Ç–∞—Ä—ã–π –±–æ–≥–µ–º–Ω—ã–π –∫–≤–∞—Ä—Ç–∞–ª —Å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏ –∏ –∂–∏–≤–æ–π –º—É–∑—ã–∫–æ–π.", "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫ –¢–∞—Ä–∞ –∏ –ó–ª–∞—Ç–∏–±–æ—Ä."],
    "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è": ["ƒÜevapƒçiƒái (—á–µ–≤a–ø—á–∏—á–∏) ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–µ —Ä—É–±–ª–µ–Ω—ã–µ –º—è—Å–Ω—ã–µ –∫–æ–ª–±–∞—Å–∫–∏ (–≥–æ–≤—è–¥–∏–Ω–∞/—Å–º–µ—à–∞–Ω–Ω–æ–µ –º—è—Å–æ), –ø–æ–¥–∞—é—Ç—Å—è —Å –ª–µ–ø—ë—à–∫–æ–π (lepinja), –ª—É–∫–æ–º –∏ –∫–∞–π–º–∞–∫–æ–º/–∞–π–≤–∞—Ä–æ–º.", "Pljeskavica (–ø–ª–µ—Å–∫–∞–≤–∏—Ü–∞) ‚Äî –±–æ–ª—å—à–∞—è –º—è—Å–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞/–±—É—Ä–≥–µ—Ä –ø–æ‚Äë–±–∞–ª–∫–∞–Ω—Å–∫–∏; —á–∞—Å—Ç–æ —Å —Å—ã—Ä–æ–º –∏–ª–∏ –ª—É–∫–æ–º.", "Burek ‚Äî —Å–ª–æ–π–Ω—ã–π –ø–∏—Ä–æ–≥ —Å –Ω–∞—á–∏–Ω–∫–æ–π (–º—è—Å–æ, —Å—ã—Ä, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å); –ø–æ–ø—É–ª—è—Ä–µ–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫."]
    }
}

# ---------------------------
# FSM
# ---------------------------
class Form(StatesGroup):
    country = State()
    section = State()
    food_index = State()
    place_index = State()
    checklist = State()

# ---------------------------
# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
# ---------------------------
def country_keyboard():
    return ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text=country)] for country in countries_info],
        resize_keyboard=True
    )

def country_sections_keyboard():
    sections = [
        "–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏",
        "–¢—Ä–µ–±—É–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
        "–°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –≤–∑—è—Ç—å",
        "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è",
        "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è",
        "–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞",
        "–ù–∞–∑–∞–¥"
    ]
    keyboard = [sections[i:i + 3] for i in range(0, len(sections), 3)]
    return ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text=s) for s in row] for row in keyboard],
        resize_keyboard=True
    )

def food_carousel_keyboard(index, max_index):
    buttons = []
    if index > 0:
        buttons.append(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"food_nav_{index - 1}"))
    if index < max_index:
        buttons.append(InlineKeyboardButton(text="‚û°Ô∏è –î–∞–ª–µ–µ", callback_data=f"food_nav_{index + 1}"))
    return InlineKeyboardMarkup(inline_keyboard=[buttons])

def places_carousel_keyboard(index, max_index):
    buttons = []
    if index > 0:
        buttons.append(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"places_nav_{index - 1}"))
    if index < max_index:
        buttons.append(InlineKeyboardButton(text="‚û°Ô∏è –î–∞–ª–µ–µ", callback_data=f"places_nav_{index + 1}"))
    return InlineKeyboardMarkup(inline_keyboard=[buttons])

def checklist_keyboard(items, checked):
    buttons = []
    for i, item in enumerate(items):
        text = f"‚úÖ {item}" if checked[i] else item
        buttons.append([InlineKeyboardButton(text=text, callback_data=f"check_{i}")])
    return InlineKeyboardMarkup(inline_keyboard=buttons)

# ---------------------------
# –•–µ–Ω–¥–ª–µ—Ä—ã
# ---------------------------
@dp.message(Command("start"))
async def start_handler(message: Message, state: FSMContext):
    await state.clear()
    await state.set_state(Form.country)
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É:", reply_markup=country_keyboard())

@dp.message(Form.country)
async def country_selected(message: Message, state: FSMContext):
    if message.text in countries_info:
        await state.update_data(country=message.text)
        await state.set_state(Form.section)
        await message.answer(
            f"–í—ã –≤—ã–±—Ä–∞–ª–∏ {message.text}. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:",
            reply_markup=country_sections_keyboard()
        )
    else:
        await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –∏–∑ —Å–ø–∏—Å–∫–∞.")

@dp.message(Form.section)
async def section_selected(message: Message, state: FSMContext):
    data = await state.get_data()
    country = data["country"]
    section = message.text

    if section == "–ù–∞–∑–∞–¥":
        await state.set_state(Form.country)
        await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É:", reply_markup=country_keyboard())
        return

    if section == "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è":
        places = countries_info[country][section]
        await state.update_data(place_index=0)
        name = places[0]
        await message.answer_photo(
            FSInputFile(local_images[country][name]),
            caption=name,
            reply_markup=places_carousel_keyboard(0, len(places) - 1)
        )
        return

    if section == "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è":
        foods = countries_info[country][section]
        await state.update_data(food_index=0)
        name = foods[0]
        await message.answer_photo(
            FSInputFile(local_images[country][name]),
            caption=name,
            reply_markup=food_carousel_keyboard(0, len(foods) - 1)
        )
        return

    if section == "–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞":
        checklist = ["–ü–∞—Å–ø–æ—Ä—Ç", "–ë–∏–ª–µ—Ç—ã", "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞", "–£–¥–æ–±–Ω–∞—è –æ–±—É–≤—å", "–§–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç"]
        checked = [False] * len(checklist)
        await state.update_data(checklist_items=checklist, checklist_checked=checked)
        await message.answer("–í–∞—à —á–µ–∫-–ª–∏—Å—Ç:", reply_markup=checklist_keyboard(checklist, checked))
        return

    await message.answer(countries_info[country].get(section, "–†–∞–∑–¥–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"))

# ---------------------------
# –ö–∞—Ä—É—Å–µ–ª–∏
# ---------------------------
@dp.callback_query(lambda c: c.data.startswith("food_nav_"))
async def food_nav(callback: types.CallbackQuery, state: FSMContext):
    index = int(callback.data.split("_")[-1])
    data = await state.get_data()
    country = data["country"]
    foods = countries_info[country]["–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è"]
    name = foods[index]
    await callback.message.edit_media(
        media=types.InputMediaPhoto(
            media=FSInputFile(local_images[country][name]),
            caption=name
        ),
        reply_markup=food_carousel_keyboard(index, len(foods) - 1)
    )
    await callback.answer()

@dp.callback_query(lambda c: c.data.startswith("places_nav_"))
async def places_nav(callback: types.CallbackQuery, state: FSMContext):
    index = int(callback.data.split("_")[-1])
    data = await state.get_data()
    country = data["country"]
    places = countries_info[country]["–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è"]
    name = places[index]
    await callback.message.edit_media(
        media=types.InputMediaPhoto(
            media=FSInputFile(local_images[country][name]),
            caption=name
        ),
        reply_markup=places_carousel_keyboard(index, len(places) - 1)
    )
    await callback.answer()

# ---------------------------
# –ß–µ–∫-–ª–∏—Å—Ç
# ---------------------------
@dp.callback_query(lambda c: c.data.startswith("check_"))
async def checklist_toggle(callback: types.CallbackQuery, state: FSMContext):
    index = int(callback.data.split("_")[1])
    data = await state.get_data()
    items = data["checklist_items"]
    checked = data["checklist_checked"]
    checked[index] = not checked[index]
    await state.update_data(checklist_checked=checked)
    await callback.message.edit_reply_markup(
        reply_markup=checklist_keyboard(items, checked)
    )
    await callback.answer()

# ---------------------------
# –ó–∞–ø—É—Å–∫
# ---------------------------
if __name__ == "__main__":
    asyncio.run(dp.start_polling(bot))